<?xml version="1.0" encoding="UTF-8"?>
<openerp>
  <data>

    <template id="report_saleorder_document" inherit_id="sale.report_saleorder_document">
      <xpath expr="//tbody[@class='sale_tbody']" position="attributes">
        <attribute name="t-if">doc._context.get('display_original_view')</attribute>
      </xpath>
      <xpath expr="//tbody[@class='sale_tbody']" position="after">
        <tbody class="sale_tbody" t-if="not doc._context.get('display_original_view')">
          <t t-foreach="doc.visible_line_ids" t-as="l">
            <tr t-if="l.product_uom_qty">
              <td>
                <span t-field="l.name"/>
              </td>
              <td class="text-right">
                <span t-field="l.product_uom_qty"/>
                <span groups="product.group_uom" t-field="l.product_uom"/>
              </td>
              <td class="text-right">
                <span t-field="l.visible_price_unit"/>
              </td>
              <td t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">
                <span t-field="l.discount"/>
              </td>
              <td class="text-right">
                <span t-esc="', '.join(map(lambda x: (x.description or x.name), l.tax_id))"/>
              </td>
              <td class="text-right">
                <span t-field="l.visible_price_subtotal"
                  t-field-options='{"widget": "monetary", "display_currency": "doc.pricelist_id.currency_id"}'/>
              </td>
            </tr>
          </t>
        </tbody>
      </xpath>
    </template>

  </data>
</openerp>
